{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {"url": "data/metro_systems.csv"},
    "width": 500,
    "height": 600,
    "layer": [
      {
        "mark": "rule",
        "encoding": {
          "x": {"value": 0},
          "opacity": {"value": 0},
          "y": {
            "field": "annual_ridership_millions",
            "type": "quantitative",
            "axis": {"grid": false, "title": null}
          },
          "detail": {"field": "Name"}
        }
      },
      {
        "mark": "rule",
        "encoding": {
          "x": {"value": 0},
          "opacity": {"value": 0},
          "y": {
            "field": "system_length",
            "type": "quantitative",
            "axis": {
              "grid": false,
              "title": null,
              "orient": "right",
              "offset": {"expr": "-width / 2"}
            }
          },
          "detail": {"field": "Name"}
        }
      },
      {
        "mark": "rule",
        "encoding": {
          "x": {"value": 0},
          "opacity": {"value": 0},
          "y": {
            "field": "stations",
            "type": "quantitative",
            "axis": {"grid": false, "title": null, "orient": "right", "offset": 0}
          }
        }
      },
      {
        "transform": [
          {
            "calculate": "['Annual Ridership in millions', 'system_length', 'stations']",
            "as": "x"
          },
          {
            "calculate": "[height - scale('layer_0_y', datum.annual_ridership_millions), height - scale('layer_1_y', datum.system_length), height - scale('layer_2_y', datum.stations)]",
            "as": "y"
          },
          {"flatten": ["x", "y"]}
        ],
        "selection": {
          "continent_highlight": {
            "type": "multi",
            "fields": ["continent"],
            "bind": "legend"
          }
        },
        "mark": {"type": "line", "point": true, "strokeWidth": 0.4},
        "encoding": {
          "color": {
            "field": "continent",
            "type": "nominal",
            "scale": {
              "domain": ["North America", "South America", "Europe", "Africa", "Asia", "Oceania"],
              "range": ["#e41a1c", "#984ea3", "#ff7f00", "blue", "#377eb8", "#a65628"]
            }
          },
          "opacity": {
            "condition": {"param": "continent_highlight", "value": 0.6},
            "value": 0.0001
          },
          "x": {
            "field": "x",
            "sort": null,
            "type": "ordinal",
            "scale": {"type": "point", "padding": 0},
            "axis": {"title": null, "labelAngle": 0, "domain": false}
          },
          "y": {"field": "y", "type": "quantitative", "axis": null},
          "detail": {"field": "Name"},
          "tooltip": [
            {"field": "name", "type": "nominal", "title": "Name"},
            {"field": "country", "type": "nominal", "title": "Country"},
            {"field": "annual_ridership_millions", "type": "quantitative", "title": "Annual Ridership in Millions"},
            {"field": "system_length", "type": "quantitative", "title": "System Length (km)"},
            {"field": "stations", "type": "quantitative", "title": "Number of Stations"}
          ]  
        }
      },
      {
        "mark": {
          "type": "text",
          "align": "left",
          "baseline": "middle",
          "dx": -245,
          "dy": -260,
          "fontSize": 11.5,
          "fontStyle": "italic"
        },
        "encoding": {
          "text": {"field": "name", "type": "nominal"},
          "color": {"value": "black"},
          "opacity": {
            "condition": {
            "test": "datum['name'] == 'Shanghai Metro'",
            "value": 1
            },
          "value": 0
          }
        }
      },
      {
        "mark": {
          "type": "text",
          "align": "left",
          "baseline": "middle",
          "dx": -245,
          "dy": -105,
          "fontSize": 11.5,
          "fontStyle": "italic"
        },
        "encoding": {
          "text": {"field": "name", "type": "nominal"},
          "color": {"value": "black"},
          "opacity": {
            "condition": {
            "test": "datum['name'] == 'Moscow Metro'",
            "value": 1
            },
          "value": 0
          }
        }
      },
      {
        "mark": {
          "type": "text",
          "align": "left",
          "baseline": "middle",
          "dx": -245,
          "dy": -50,
          "fontSize": 11.5,
          "fontStyle": "italic"
        },
        "encoding": {
          "text": {"field": "name", "type": "nominal"},
          "color": {"value": "black"},
          "opacity": {
            "condition": {
            "test": "datum['name'] == 'New York City Subway'",
            "value": 1
            },
          "value": 0
          }
        }
      }
    ],
    "resolve": {"scale": {"y": "independent"}},
    "config": {"padding": 0, "view": {"stroke": null}}
  }